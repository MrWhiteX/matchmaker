"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/user/reset-password";
exports.ids = ["pages/api/user/reset-password"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "@sendgrid/mail":
/*!*********************************!*\
  !*** external "@sendgrid/mail" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@sendgrid/mail");

/***/ }),

/***/ "joi":
/*!**********************!*\
  !*** external "joi" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("joi");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./models/index.ts":
/*!*************************!*\
  !*** ./models/index.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"conversation\": () => (/* binding */ conversation),\n/* harmony export */   \"conversationMessage\": () => (/* binding */ conversationMessage),\n/* harmony export */   \"conversationUser\": () => (/* binding */ conversationUser),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   \"filter\": () => (/* binding */ filter),\n/* harmony export */   \"profileCheck\": () => (/* binding */ profileCheck),\n/* harmony export */   \"skill\": () => (/* binding */ skill),\n/* harmony export */   \"timezone\": () => (/* binding */ timezone),\n/* harmony export */   \"user\": () => (/* binding */ user)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nlet prisma;\n\nif (false) {} else {\n  let globalWithPrisma = global;\n\n  if (!globalWithPrisma.prisma) {\n    globalWithPrisma.prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n  }\n\n  prisma = globalWithPrisma.prisma;\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\nconst {\n  conversation,\n  conversationUser,\n  conversationMessage,\n  user,\n  filter,\n  skill,\n  timezone,\n  profileCheck\n} = prisma;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9tb2RlbHMvaW5kZXgudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUVBLElBQUlDLE1BQUo7O0FBRUEsSUFBSSxPQUF1QyxFQUEzQyxNQUVPO0VBQ0wsSUFBSUMsZ0JBQWdCLEdBQUdDLE1BQXZCOztFQUdBLElBQUksQ0FBQ0QsZ0JBQWdCLENBQUNELE1BQXRCLEVBQThCO0lBQzVCQyxnQkFBZ0IsQ0FBQ0QsTUFBakIsR0FBMEIsSUFBSUQsd0RBQUosRUFBMUI7RUFDRDs7RUFDREMsTUFBTSxHQUFHQyxnQkFBZ0IsQ0FBQ0QsTUFBMUI7QUFDRDs7QUFFRCxpRUFBZUEsTUFBZjtBQUVPLE1BQU07RUFDWEcsWUFEVztFQUVYQyxnQkFGVztFQUdYQyxtQkFIVztFQUlYQyxJQUpXO0VBS1hDLE1BTFc7RUFNWEMsS0FOVztFQU9YQyxRQVBXO0VBUVhDO0FBUlcsSUFTVFYsTUFURyIsInNvdXJjZXMiOlsid2VicGFjazovL05hdWthLy4vbW9kZWxzL2luZGV4LnRzPzg2ZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5cbmxldCBwcmlzbWE6IFByaXNtYUNsaWVudDtcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIikge1xuICBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG59IGVsc2Uge1xuICBsZXQgZ2xvYmFsV2l0aFByaXNtYSA9IGdsb2JhbCBhcyB0eXBlb2YgZ2xvYmFsVGhpcyAmIHtcbiAgICBwcmlzbWE6IFByaXNtYUNsaWVudDtcbiAgfTtcbiAgaWYgKCFnbG9iYWxXaXRoUHJpc21hLnByaXNtYSkge1xuICAgIGdsb2JhbFdpdGhQcmlzbWEucHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuICB9XG4gIHByaXNtYSA9IGdsb2JhbFdpdGhQcmlzbWEucHJpc21hO1xufVxuXG5leHBvcnQgZGVmYXVsdCBwcmlzbWE7XG5cbmV4cG9ydCBjb25zdCB7XG4gIGNvbnZlcnNhdGlvbixcbiAgY29udmVyc2F0aW9uVXNlcixcbiAgY29udmVyc2F0aW9uTWVzc2FnZSxcbiAgdXNlcixcbiAgZmlsdGVyLFxuICBza2lsbCxcbiAgdGltZXpvbmUsXG4gIHByb2ZpbGVDaGVjayxcbn0gPSBwcmlzbWE7XG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2xvYmFsV2l0aFByaXNtYSIsImdsb2JhbCIsImNvbnZlcnNhdGlvbiIsImNvbnZlcnNhdGlvblVzZXIiLCJjb252ZXJzYXRpb25NZXNzYWdlIiwidXNlciIsImZpbHRlciIsInNraWxsIiwidGltZXpvbmUiLCJwcm9maWxlQ2hlY2siXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./models/index.ts\n");

/***/ }),

/***/ "(api)/./pages/api/user/reset-password.ts":
/*!******************************************!*\
  !*** ./pages/api/user/reset-password.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var services_users_sendResetToken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! services/users/sendResetToken */ \"(api)/./services/users/sendResetToken.ts\");\n/* harmony import */ var services_users_changePassword__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! services/users/changePassword */ \"(api)/./services/users/changePassword.ts\");\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res) => {\n  const payload = req.body;\n\n  switch (req.method) {\n    case \"POST\":\n      {\n        try {\n          await (0,services_users_sendResetToken__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(payload);\n          res.status(200).json({\n            status: \"ok\"\n          });\n        } catch (error) {\n          res.status(422).json({\n            status: \"error\",\n            error: error\n          });\n        }\n\n        break;\n      }\n\n    case \"PUT\":\n      {\n        try {\n          const user = await (0,services_users_changePassword__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(payload);\n          res.status(200).json({\n            status: \"ok\",\n            user\n          });\n        } catch (error) {\n          res.status(422).json({\n            status: \"error\",\n            error: error\n          });\n        }\n\n        break;\n      }\n\n    default:\n      res.status(400);\n  }\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdXNlci9yZXNldC1wYXNzd29yZC50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTtBQUVBO0FBRUEsaUVBQWUsT0FBT0UsR0FBUCxFQUE0QkMsR0FBNUIsS0FBcUQ7RUFDbEUsTUFBTUMsT0FBdUIsR0FBR0YsR0FBRyxDQUFDRyxJQUFwQzs7RUFFQSxRQUFRSCxHQUFHLENBQUNJLE1BQVo7SUFDRSxLQUFLLE1BQUw7TUFBYTtRQUNYLElBQUk7VUFDRixNQUFNTix5RUFBYyxDQUFDSSxPQUFELENBQXBCO1VBQ0FELEdBQUcsQ0FBQ0ksTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO1lBQUVELE1BQU0sRUFBRTtVQUFWLENBQXJCO1FBQ0QsQ0FIRCxDQUdFLE9BQU9FLEtBQVAsRUFBdUI7VUFDdkJOLEdBQUcsQ0FBQ0ksTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCO1lBQUVELE1BQU0sRUFBRSxPQUFWO1lBQW1CRSxLQUFLLEVBQUVBO1VBQTFCLENBQXJCO1FBQ0Q7O1FBRUQ7TUFDRDs7SUFDRCxLQUFLLEtBQUw7TUFBWTtRQUNWLElBQUk7VUFDRixNQUFNQyxJQUFJLEdBQUcsTUFBTVQseUVBQWMsQ0FBQ0csT0FBRCxDQUFqQztVQUVBRCxHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQjtZQUFFRCxNQUFNLEVBQUUsSUFBVjtZQUFnQkc7VUFBaEIsQ0FBckI7UUFDRCxDQUpELENBSUUsT0FBT0QsS0FBUCxFQUF1QjtVQUN2Qk4sR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7WUFBRUQsTUFBTSxFQUFFLE9BQVY7WUFBbUJFLEtBQUssRUFBRUE7VUFBMUIsQ0FBckI7UUFDRDs7UUFDRDtNQUNEOztJQUNEO01BQ0VOLEdBQUcsQ0FBQ0ksTUFBSixDQUFXLEdBQVg7RUF0Qko7QUF3QkQsQ0EzQkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9OYXVrYS8uL3BhZ2VzL2FwaS91c2VyL3Jlc2V0LXBhc3N3b3JkLnRzPzBjYTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgc2VuZFJlc2V0VG9rZW4gZnJvbSBcInNlcnZpY2VzL3VzZXJzL3NlbmRSZXNldFRva2VuXCI7XG5pbXBvcnQgeyBJUmVzZXRQYXNzd29yZCB9IGZyb20gXCJ0eXBlcy90eXBlc1wiO1xuaW1wb3J0IGNoYW5nZVBhc3N3b3JkIGZyb20gXCJzZXJ2aWNlcy91c2Vycy9jaGFuZ2VQYXNzd29yZFwiO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgcGF5bG9hZDogSVJlc2V0UGFzc3dvcmQgPSByZXEuYm9keTtcblxuICBzd2l0Y2ggKHJlcS5tZXRob2QpIHtcbiAgICBjYXNlIFwiUE9TVFwiOiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBzZW5kUmVzZXRUb2tlbihwYXlsb2FkKTtcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBzdGF0dXM6IFwib2tcIiB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDIyKS5qc29uKHsgc3RhdHVzOiBcImVycm9yXCIsIGVycm9yOiBlcnJvciB9KTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJQVVRcIjoge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGNoYW5nZVBhc3N3b3JkKHBheWxvYWQpO1xuXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgc3RhdHVzOiBcIm9rXCIsIHVzZXIgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgICByZXMuc3RhdHVzKDQyMikuanNvbih7IHN0YXR1czogXCJlcnJvclwiLCBlcnJvcjogZXJyb3IgfSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHJlcy5zdGF0dXMoNDAwKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJzZW5kUmVzZXRUb2tlbiIsImNoYW5nZVBhc3N3b3JkIiwicmVxIiwicmVzIiwicGF5bG9hZCIsImJvZHkiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ1c2VyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/user/reset-password.ts\n");

/***/ }),

/***/ "(api)/./services/users/changePassword.ts":
/*!******************************************!*\
  !*** ./services/users/changePassword.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var models__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! models */ \"(api)/./models/index.ts\");\n/* harmony import */ var joi__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! joi */ \"joi\");\n/* harmony import */ var joi__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(joi__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst schema = joi__WEBPACK_IMPORTED_MODULE_1___default().object({\n  resetToken: joi__WEBPACK_IMPORTED_MODULE_1___default().string().required(),\n  password: joi__WEBPACK_IMPORTED_MODULE_1___default().string().min(5).required().messages({\n    \"string.min\": \"Password should have a minimum length of {#limit} characters\"\n  })\n});\n\nconst changePassword = async payload => {\n  const {\n    password,\n    resetToken\n  } = await schema.validateAsync(payload);\n  let userDB = await models__WEBPACK_IMPORTED_MODULE_0__.user.findFirst({\n    where: {\n      resetToken\n    }\n  });\n\n  if (!userDB) {\n    throw new Error(\"wrong_token\");\n  }\n\n  const passwordSalt = crypto__WEBPACK_IMPORTED_MODULE_2___default().randomBytes(22).toString(\"hex\");\n  const passwordHash = crypto__WEBPACK_IMPORTED_MODULE_2___default().pbkdf2Sync(password, passwordSalt, 1000, 64, `sha512`).toString(\"hex\");\n  await models__WEBPACK_IMPORTED_MODULE_0__.user.update({\n    where: {\n      id: userDB.id\n    },\n    data: {\n      passwordHash,\n      passwordSalt,\n      resetToken: null\n    }\n  });\n  return {\n    id: userDB.id,\n    email: userDB.email,\n    emailVerified: userDB.emailVerified,\n    name: userDB.name,\n    role: userDB.role,\n    image: userDB.image,\n    skill: userDB.skill,\n    timezone: userDB.timezone,\n    biogram: userDB.biogram,\n    createdAt: userDB.createdAt,\n    updatedAt: userDB.updatedAt\n  };\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (changePassword);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zZXJ2aWNlcy91c2Vycy9jaGFuZ2VQYXNzd29yZC50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFTQSxNQUFNRyxNQUFNLEdBQUdGLGlEQUFBLENBQWtDO0VBQy9DSSxVQUFVLEVBQUVKLGlEQUFBLEdBQWFNLFFBQWIsRUFEbUM7RUFFL0NDLFFBQVEsRUFBRVAsaURBQUEsR0FBYVEsR0FBYixDQUFpQixDQUFqQixFQUFvQkYsUUFBcEIsR0FBK0JHLFFBQS9CLENBQXdDO0lBQ2hELGNBQ0U7RUFGOEMsQ0FBeEM7QUFGcUMsQ0FBbEMsQ0FBZjs7QUFRQSxNQUFNQyxjQUFjLEdBQUcsTUFBT0MsT0FBUCxJQUFtQztFQUN4RCxNQUFNO0lBQUVKLFFBQUY7SUFBWUg7RUFBWixJQUNKLE1BQU1GLE1BQU0sQ0FBQ1UsYUFBUCxDQUFxQkQsT0FBckIsQ0FEUjtFQUVBLElBQUlFLE1BQU0sR0FBRyxNQUFNZCxrREFBQSxDQUFlO0lBQ2hDZ0IsS0FBSyxFQUFFO01BQ0xYO0lBREs7RUFEeUIsQ0FBZixDQUFuQjs7RUFLQSxJQUFJLENBQUNTLE1BQUwsRUFBYTtJQUNYLE1BQU0sSUFBSUcsS0FBSixDQUFVLGFBQVYsQ0FBTjtFQUNEOztFQUVELE1BQU1DLFlBQVksR0FBR2hCLHlEQUFBLENBQW1CLEVBQW5CLEVBQXVCa0IsUUFBdkIsQ0FBZ0MsS0FBaEMsQ0FBckI7RUFDQSxNQUFNQyxZQUFZLEdBQUduQix3REFBQSxDQUNQTSxRQURPLEVBQ0dVLFlBREgsRUFDaUIsSUFEakIsRUFDdUIsRUFEdkIsRUFDNEIsUUFENUIsRUFFbEJFLFFBRmtCLENBRVQsS0FGUyxDQUFyQjtFQUlBLE1BQU1wQiwrQ0FBQSxDQUFZO0lBQ2hCZ0IsS0FBSyxFQUFFO01BQ0xRLEVBQUUsRUFBRVYsTUFBTSxDQUFDVTtJQUROLENBRFM7SUFJaEJDLElBQUksRUFBRTtNQUNKSixZQURJO01BRUpILFlBRkk7TUFHSmIsVUFBVSxFQUFFO0lBSFI7RUFKVSxDQUFaLENBQU47RUFXQSxPQUFPO0lBQ0xtQixFQUFFLEVBQUVWLE1BQU0sQ0FBQ1UsRUFETjtJQUVMRSxLQUFLLEVBQUVaLE1BQU0sQ0FBQ1ksS0FGVDtJQUdMQyxhQUFhLEVBQUViLE1BQU0sQ0FBQ2EsYUFIakI7SUFJTEMsSUFBSSxFQUFFZCxNQUFNLENBQUNjLElBSlI7SUFLTEMsSUFBSSxFQUFFZixNQUFNLENBQUNlLElBTFI7SUFNTEMsS0FBSyxFQUFFaEIsTUFBTSxDQUFDZ0IsS0FOVDtJQU9MQyxLQUFLLEVBQUVqQixNQUFNLENBQUNpQixLQVBUO0lBUUxDLFFBQVEsRUFBRWxCLE1BQU0sQ0FBQ2tCLFFBUlo7SUFTTEMsT0FBTyxFQUFFbkIsTUFBTSxDQUFDbUIsT0FUWDtJQVVMQyxTQUFTLEVBQUVwQixNQUFNLENBQUNvQixTQVZiO0lBV0xDLFNBQVMsRUFBRXJCLE1BQU0sQ0FBQ3FCO0VBWGIsQ0FBUDtBQWFELENBekNEOztBQTJDQSxpRUFBZXhCLGNBQWYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9OYXVrYS8uL3NlcnZpY2VzL3VzZXJzL2NoYW5nZVBhc3N3b3JkLnRzPzYzY2MiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlciB9IGZyb20gXCJtb2RlbHNcIjtcbmltcG9ydCBKb2kgZnJvbSBcImpvaVwiO1xuaW1wb3J0IGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XG5pbXBvcnQgbm9kZW1haWxlciBmcm9tIFwibm9kZW1haWxlclwiO1xuaW1wb3J0IHsgSVJlc2V0UGFzc3dvcmQgfSBmcm9tIFwidHlwZXMvdHlwZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJQ2hhbmdlUGFzc3dvcmRTY2hlbWEge1xuICByZXNldFRva2VuOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG59XG5cbmNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Q8SUNoYW5nZVBhc3N3b3JkU2NoZW1hPih7XG4gIHJlc2V0VG9rZW46IEpvaS5zdHJpbmcoKS5yZXF1aXJlZCgpLFxuICBwYXNzd29yZDogSm9pLnN0cmluZygpLm1pbig1KS5yZXF1aXJlZCgpLm1lc3NhZ2VzKHtcbiAgICBcInN0cmluZy5taW5cIjpcbiAgICAgIFwiUGFzc3dvcmQgc2hvdWxkIGhhdmUgYSBtaW5pbXVtIGxlbmd0aCBvZiB7I2xpbWl0fSBjaGFyYWN0ZXJzXCIsXG4gIH0pLFxufSk7XG5cbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0gYXN5bmMgKHBheWxvYWQ6IElSZXNldFBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHsgcGFzc3dvcmQsIHJlc2V0VG9rZW4gfTogSUNoYW5nZVBhc3N3b3JkU2NoZW1hID1cbiAgICBhd2FpdCBzY2hlbWEudmFsaWRhdGVBc3luYyhwYXlsb2FkKTtcbiAgbGV0IHVzZXJEQiA9IGF3YWl0IHVzZXIuZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgcmVzZXRUb2tlbixcbiAgICB9LFxuICB9KTtcbiAgaWYgKCF1c2VyREIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3cm9uZ190b2tlblwiKTtcbiAgfVxuXG4gIGNvbnN0IHBhc3N3b3JkU2FsdCA9IGNyeXB0by5yYW5kb21CeXRlcygyMikudG9TdHJpbmcoXCJoZXhcIik7XG4gIGNvbnN0IHBhc3N3b3JkSGFzaCA9IGNyeXB0b1xuICAgIC5wYmtkZjJTeW5jKHBhc3N3b3JkLCBwYXNzd29yZFNhbHQsIDEwMDAsIDY0LCBgc2hhNTEyYClcbiAgICAudG9TdHJpbmcoXCJoZXhcIik7XG5cbiAgYXdhaXQgdXNlci51cGRhdGUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogdXNlckRCLmlkLFxuICAgIH0sXG4gICAgZGF0YToge1xuICAgICAgcGFzc3dvcmRIYXNoLFxuICAgICAgcGFzc3dvcmRTYWx0LFxuICAgICAgcmVzZXRUb2tlbjogbnVsbCxcbiAgICB9LFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIGlkOiB1c2VyREIuaWQsXG4gICAgZW1haWw6IHVzZXJEQi5lbWFpbCxcbiAgICBlbWFpbFZlcmlmaWVkOiB1c2VyREIuZW1haWxWZXJpZmllZCxcbiAgICBuYW1lOiB1c2VyREIubmFtZSxcbiAgICByb2xlOiB1c2VyREIucm9sZSxcbiAgICBpbWFnZTogdXNlckRCLmltYWdlLFxuICAgIHNraWxsOiB1c2VyREIuc2tpbGwsXG4gICAgdGltZXpvbmU6IHVzZXJEQi50aW1lem9uZSxcbiAgICBiaW9ncmFtOiB1c2VyREIuYmlvZ3JhbSxcbiAgICBjcmVhdGVkQXQ6IHVzZXJEQi5jcmVhdGVkQXQsXG4gICAgdXBkYXRlZEF0OiB1c2VyREIudXBkYXRlZEF0LFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2hhbmdlUGFzc3dvcmQ7XG4iXSwibmFtZXMiOlsidXNlciIsIkpvaSIsImNyeXB0byIsInNjaGVtYSIsIm9iamVjdCIsInJlc2V0VG9rZW4iLCJzdHJpbmciLCJyZXF1aXJlZCIsInBhc3N3b3JkIiwibWluIiwibWVzc2FnZXMiLCJjaGFuZ2VQYXNzd29yZCIsInBheWxvYWQiLCJ2YWxpZGF0ZUFzeW5jIiwidXNlckRCIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJFcnJvciIsInBhc3N3b3JkU2FsdCIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJwYXNzd29yZEhhc2giLCJwYmtkZjJTeW5jIiwidXBkYXRlIiwiaWQiLCJkYXRhIiwiZW1haWwiLCJlbWFpbFZlcmlmaWVkIiwibmFtZSIsInJvbGUiLCJpbWFnZSIsInNraWxsIiwidGltZXpvbmUiLCJiaW9ncmFtIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./services/users/changePassword.ts\n");

/***/ }),

/***/ "(api)/./services/users/sendResetToken.ts":
/*!******************************************!*\
  !*** ./services/users/sendResetToken.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var models__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! models */ \"(api)/./models/index.ts\");\n/* harmony import */ var joi__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! joi */ \"joi\");\n/* harmony import */ var joi__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(joi__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _sendgrid_mail__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @sendgrid/mail */ \"@sendgrid/mail\");\n/* harmony import */ var _sendgrid_mail__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_sendgrid_mail__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nconst schema = joi__WEBPACK_IMPORTED_MODULE_1___default().object({\n  email: joi__WEBPACK_IMPORTED_MODULE_1___default().string().email().required()\n});\n\nconst sendResetToken = async payload => {\n  const {\n    email\n  } = await schema.validateAsync(payload);\n\n  if (typeof email !== \"string\" || !email) {\n    throw new Error(\"Invalid email\");\n  }\n\n  let userDB = await models__WEBPACK_IMPORTED_MODULE_0__.user.findUnique({\n    where: {\n      email: email.toLowerCase()\n    }\n  });\n\n  if (!userDB) {\n    return null;\n  }\n\n  const resetToken = crypto__WEBPACK_IMPORTED_MODULE_2___default().randomBytes(22).toString(\"hex\");\n  await models__WEBPACK_IMPORTED_MODULE_0__.user.update({\n    where: {\n      id: userDB.id\n    },\n    data: {\n      resetToken: resetToken\n    }\n  });\n  const apiKey = process.env.NODEMAILER_APIKEY;\n\n  if (!apiKey) {\n    throw new Error(\"NODEMAILER_APIKEY is not defined!\");\n  }\n\n  _sendgrid_mail__WEBPACK_IMPORTED_MODULE_3___default().setApiKey(apiKey);\n  const toEmail = process.env.CONTACT_FORM_EMAIL;\n  const fromEmail = \"matcher35323@gmail.com\";\n\n  if (!toEmail || !fromEmail) {\n    return null;\n  }\n\n  const msg = {\n    to: email,\n    from: fromEmail,\n    replyTo: email,\n    subject: `Change your password`,\n    html: `\n    Hey! <br/>Please change your password here:\n    <a href=\"http://${\"localhost:3000\"}/update-password?token=${resetToken}\">\n    http://${\"localhost:3000\"}/update-password?token=${resetToken}\n    </a>\n  `\n  };\n  await _sendgrid_mail__WEBPACK_IMPORTED_MODULE_3___default().send(msg);\n  return resetToken;\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (sendResetToken);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zZXJ2aWNlcy91c2Vycy9zZW5kUmVzZXRUb2tlbi50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBT0EsTUFBTUksTUFBTSxHQUFHSCxpREFBQSxDQUF5QjtFQUN0Q0ssS0FBSyxFQUFFTCxpREFBQSxHQUFhSyxLQUFiLEdBQXFCRSxRQUFyQjtBQUQrQixDQUF6QixDQUFmOztBQUlBLE1BQU1DLGNBQWMsR0FBRyxNQUFPQyxPQUFQLElBQW1DO0VBQ3hELE1BQU07SUFBRUo7RUFBRixJQUEwQixNQUFNRixNQUFNLENBQUNPLGFBQVAsQ0FBcUJELE9BQXJCLENBQXRDOztFQUNBLElBQUksT0FBT0osS0FBUCxLQUFpQixRQUFqQixJQUE2QixDQUFDQSxLQUFsQyxFQUF5QztJQUN2QyxNQUFNLElBQUlNLEtBQUosQ0FBVSxlQUFWLENBQU47RUFDRDs7RUFFRCxJQUFJQyxNQUFNLEdBQUcsTUFBTWIsbURBQUEsQ0FBZ0I7SUFDakNlLEtBQUssRUFBRTtNQUNMVCxLQUFLLEVBQUVBLEtBQUssQ0FBQ1UsV0FBTjtJQURGO0VBRDBCLENBQWhCLENBQW5COztFQUtBLElBQUksQ0FBQ0gsTUFBTCxFQUFhO0lBQ1gsT0FBTyxJQUFQO0VBQ0Q7O0VBRUQsTUFBTUksVUFBVSxHQUFHZix5REFBQSxDQUFtQixFQUFuQixFQUF1QmlCLFFBQXZCLENBQWdDLEtBQWhDLENBQW5CO0VBRUEsTUFBTW5CLCtDQUFBLENBQVk7SUFDaEJlLEtBQUssRUFBRTtNQUNMTSxFQUFFLEVBQUVSLE1BQU0sQ0FBQ1E7SUFETixDQURTO0lBSWhCQyxJQUFJLEVBQUU7TUFDSkwsVUFBVSxFQUFFQTtJQURSO0VBSlUsQ0FBWixDQUFOO0VBU0EsTUFBTU0sTUFBTSxHQUFHQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsaUJBQTNCOztFQUVBLElBQUksQ0FBQ0gsTUFBTCxFQUFhO0lBQ1gsTUFBTSxJQUFJWCxLQUFKLENBQVUsbUNBQVYsQ0FBTjtFQUNEOztFQUNEVCwrREFBQSxDQUFpQm9CLE1BQWpCO0VBRUEsTUFBTUssT0FBTyxHQUFHSixPQUFPLENBQUNDLEdBQVIsQ0FBWUksa0JBQTVCO0VBQ0EsTUFBTUMsU0FBUyxHQUFHLHdCQUFsQjs7RUFFQSxJQUFJLENBQUNGLE9BQUQsSUFBWSxDQUFDRSxTQUFqQixFQUE0QjtJQUMxQixPQUFPLElBQVA7RUFDRDs7RUFFRCxNQUFNQyxHQUFHLEdBQUc7SUFDVkMsRUFBRSxFQUFFMUIsS0FETTtJQUVWMkIsSUFBSSxFQUFFSCxTQUZJO0lBR1ZJLE9BQU8sRUFBRTVCLEtBSEM7SUFJVjZCLE9BQU8sRUFBRyxzQkFKQTtJQUtWQyxJQUFJLEVBQUc7QUFDWDtBQUNBLHNCQUFzQlosZ0JBQWlDLDBCQUF5QlAsVUFBVztBQUMzRixhQUFhTyxnQkFBaUMsMEJBQXlCUCxVQUFXO0FBQ2xGO0FBQ0E7RUFWYyxDQUFaO0VBYUEsTUFBTWQsMERBQUEsQ0FBWTRCLEdBQVosQ0FBTjtFQUVBLE9BQU9kLFVBQVA7QUFDRCxDQXhERDs7QUEwREEsaUVBQWVSLGNBQWYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9OYXVrYS8uL3NlcnZpY2VzL3VzZXJzL3NlbmRSZXNldFRva2VuLnRzPzNhNTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlciB9IGZyb20gXCJtb2RlbHNcIjtcbmltcG9ydCBKb2kgZnJvbSBcImpvaVwiO1xuaW1wb3J0IGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XG5pbXBvcnQgc2dNYWlsIGZyb20gXCJAc2VuZGdyaWQvbWFpbFwiO1xuaW1wb3J0IHsgSVJlc2V0UGFzc3dvcmQgfSBmcm9tIFwidHlwZXMvdHlwZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJUmVzZXRTY2hlbWEge1xuICBlbWFpbDogc3RyaW5nO1xufVxuXG5jb25zdCBzY2hlbWEgPSBKb2kub2JqZWN0PElSZXNldFNjaGVtYT4oe1xuICBlbWFpbDogSm9pLnN0cmluZygpLmVtYWlsKCkucmVxdWlyZWQoKSxcbn0pO1xuXG5jb25zdCBzZW5kUmVzZXRUb2tlbiA9IGFzeW5jIChwYXlsb2FkOiBJUmVzZXRQYXNzd29yZCkgPT4ge1xuICBjb25zdCB7IGVtYWlsIH06IElSZXNldFNjaGVtYSA9IGF3YWl0IHNjaGVtYS52YWxpZGF0ZUFzeW5jKHBheWxvYWQpO1xuICBpZiAodHlwZW9mIGVtYWlsICE9PSBcInN0cmluZ1wiIHx8ICFlbWFpbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZW1haWxcIik7XG4gIH1cblxuICBsZXQgdXNlckRCID0gYXdhaXQgdXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCksXG4gICAgfSxcbiAgfSk7XG4gIGlmICghdXNlckRCKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByZXNldFRva2VuID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDIyKS50b1N0cmluZyhcImhleFwiKTtcblxuICBhd2FpdCB1c2VyLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB1c2VyREIuaWQsXG4gICAgfSxcbiAgICBkYXRhOiB7XG4gICAgICByZXNldFRva2VuOiByZXNldFRva2VuLFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5PREVNQUlMRVJfQVBJS0VZO1xuXG4gIGlmICghYXBpS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTk9ERU1BSUxFUl9BUElLRVkgaXMgbm90IGRlZmluZWQhXCIpO1xuICB9XG4gIHNnTWFpbC5zZXRBcGlLZXkoYXBpS2V5KTtcblxuICBjb25zdCB0b0VtYWlsID0gcHJvY2Vzcy5lbnYuQ09OVEFDVF9GT1JNX0VNQUlMO1xuICBjb25zdCBmcm9tRW1haWwgPSBcIm1hdGNoZXIzNTMyM0BnbWFpbC5jb21cIjtcblxuICBpZiAoIXRvRW1haWwgfHwgIWZyb21FbWFpbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgbXNnID0ge1xuICAgIHRvOiBlbWFpbCxcbiAgICBmcm9tOiBmcm9tRW1haWwsXG4gICAgcmVwbHlUbzogZW1haWwgYXMgc3RyaW5nLFxuICAgIHN1YmplY3Q6IGBDaGFuZ2UgeW91ciBwYXNzd29yZGAsXG4gICAgaHRtbDogYFxuICAgIEhleSEgPGJyLz5QbGVhc2UgY2hhbmdlIHlvdXIgcGFzc3dvcmQgaGVyZTpcbiAgICA8YSBocmVmPVwiaHR0cDovLyR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFTRV9VUkx9L3VwZGF0ZS1wYXNzd29yZD90b2tlbj0ke3Jlc2V0VG9rZW59XCI+XG4gICAgaHR0cDovLyR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFTRV9VUkx9L3VwZGF0ZS1wYXNzd29yZD90b2tlbj0ke3Jlc2V0VG9rZW59XG4gICAgPC9hPlxuICBgLFxuICB9O1xuXG4gIGF3YWl0IHNnTWFpbC5zZW5kKG1zZyk7XG5cbiAgcmV0dXJuIHJlc2V0VG9rZW47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBzZW5kUmVzZXRUb2tlbjtcbiJdLCJuYW1lcyI6WyJ1c2VyIiwiSm9pIiwiY3J5cHRvIiwic2dNYWlsIiwic2NoZW1hIiwib2JqZWN0IiwiZW1haWwiLCJzdHJpbmciLCJyZXF1aXJlZCIsInNlbmRSZXNldFRva2VuIiwicGF5bG9hZCIsInZhbGlkYXRlQXN5bmMiLCJFcnJvciIsInVzZXJEQiIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsInRvTG93ZXJDYXNlIiwicmVzZXRUb2tlbiIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJ1cGRhdGUiLCJpZCIsImRhdGEiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiTk9ERU1BSUxFUl9BUElLRVkiLCJzZXRBcGlLZXkiLCJ0b0VtYWlsIiwiQ09OVEFDVF9GT1JNX0VNQUlMIiwiZnJvbUVtYWlsIiwibXNnIiwidG8iLCJmcm9tIiwicmVwbHlUbyIsInN1YmplY3QiLCJodG1sIiwiTkVYVF9QVUJMSUNfQkFTRV9VUkwiLCJzZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./services/users/sendResetToken.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/user/reset-password.ts"));
module.exports = __webpack_exports__;

})();